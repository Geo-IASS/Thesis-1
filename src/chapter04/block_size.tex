%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Introduction
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Introduction}
\label{profiling:blockSize:introduction}
To further investigate the

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Method
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Method}
\label{profiling:blockSize:method}
% TODO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Results
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Results}
\label{profiling:blockSize:results}
This section details the results of profiling the initial \progLang{C}
implementation of the \command{TopN_Outlier_Pruning_Block} function across
numerous data sets, and with a varying block size. In addition, the execution
time of the algorithm was compared with a modified implementation which does not
use blocking in any way.

The data for the plots was obtained using the \software{MATLAB}
\command{profile} command. Descriptions of the data sets can be found in
\autoref{dataSets}.

% TODO

Please note that the legend in \autoref{profiling:blockSize:legend:datasets} is
common to \autoref{profiling:blockSize:totalExecutionTime},
\autoref{profiling:blockSize:functionExecutionTime},
\autoref{profiling:blockSize:distanceCalls} and
\autoref{profiling:blockSize:vectorsPruned}. Additionally, the legend in
\autoref{profiling:blockSize:legend:block_sizes} is common to
\autoref{profiling:blockSize:totalRunTimeComplexity:linear},
\autoref{profiling:blockSize:totalRunTimeComplexity:logarithmic},
\autoref{profiling:blockSize:functionRunTimeComplexity:linear} and
\autoref{profiling:blockSize:functionRunTimeComplexity:logarithmic}.

\begin{figure}
    \centering
    \input{plots/block_size/legend-datasets}
    \caption[Block size profiling legend]{The data sets legend for all figures
        in \autoref{profiling:blockSize}}
    \label{profiling:blockSize:legend:datasets}
\end{figure}

\begin{figure}
    \centering
    \input{plots/block_size/total_execution_time}
    \caption{Total algorithm execution time with various block size
        implementations}
    \label{profiling:blockSize:totalExecutionTime}
\end{figure}

\begin{figure}
    \centering
    \input{plots/block_size/function_execution_time}
    \caption{Function execution time with various block size implementations}
    \label{profiling:blockSize:functionExecutionTime}
\end{figure}

\begin{figure}
    \centering
    \input{plots/block_size/distance_calls}
    \caption{Number of calls to the \command{distance} function with various
        block size implementations}
    \label{profiling:blockSize:distanceCalls}
\end{figure}

\begin{figure}
    \centering
    \input{plots/block_size/vectors_pruned}
    \caption[Number of vectors pruned with various block size implementations]{
        Number of vectors pruned (for the \command{TopN_Outlier_Pruning_Block}
        function) with various block size implementations}
    \label{profiling:blockSize:vectorsPruned}
\end{figure}

\begin{figure}
    \centering
    \input{plots/block_size/legend-block_sizes}
    \caption[Block size profiling legend]{The block sizes legend for all figures
        in \autoref{profiling:blockSize}}
    \label{profiling:blockSize:legend:block_sizes}
\end{figure}

\begin{figure}
    \centering
    \begin{minipage}{\textwidth}
        \centering
        \input{plots/block_size/total_run_time_complexity.lin}
        \caption[Total run time complexity with various block size
            implementations (linear)]{Total run time complexity (for the
            \command{TopN_Outlier_Pruning_Block} function) with various block
            size implementations}
        \label{profiling:blockSize:totalRunTimeComplexity:linear}
    \end{minipage}
    \begin{minipage}{\textwidth}
        \centering
        \input{plots/block_size/total_run_time_complexity.log}
        \caption[Total run time complexity with various block size
            implementations (logarithmic)]{Total run time complexity (for the
            \command{TopN_Outlier_Pruning_Block} function) with various block
            size implementations}
        \label{profiling:blockSize:totalRunTimeComplexity:logarithmic}
    \end{minipage}
\end{figure}

\begin{figure}
    \centering
    \begin{minipage}{\textwidth}
        \centering
        \input{plots/block_size/function_run_time_complexity.lin}
        \caption[Function run time complexity with various block size
            implementations (linear)]{Function run time complexity (for the
            \command{TopN_Outlier_Pruning_Block} function) with various block
            size implementations}
        \label{profiling:blockSize:functionRunTimeComplexity:linear}
    \end{minipage}
    \begin{minipage}{\textwidth}
       \centering
        \input{plots/block_size/function_run_time_complexity.log}
        \caption[Function run time complexity with various block size
            implementations (logarithmic)]{Function run time complexity (for the
            \command{TopN_Outlier_Pruning_Block} function) with various block
            size implementations}
        \label{profiling:blockSize:functionRunTimeComplexity:logarithmic}
    \end{minipage}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Discussion
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Discussion}
\label{algorithmPerformance:discussion}
The results collected above

\begin{itemize}
    \item Most data sets seem to perform better without blocking than with,
        although the performance difference between a small block size (less
        than 1000), compared to no blocking, is not significant.
    \item Most data sets seems to perform significantly worse with large block
        sizes (greater than 1000), when compared with smaller block sizes (less
        than 1000).
    \item Fairly stable with block size of < 1000 or > 1000000
    \item Seven data sets (\dataset{letter-recognition}, \dataset{magicgamma},
        \dataset{connect4}, \dataset{musk}, \dataset{spam_train}, \dataset{spam}
        and \dataset{runningex30k}) performed significantly better without
        blocking (at least 5 times when compared to a block size > 1000000)
    \item The total number of calls to the distance function is nearly linear in
        the block size.
    \item Four data sets (\dataset{segmentation}, \dataset{pendigits},
        \dataset{spam} and \dataset{mesh_network}) had no change in the number
        of calls to the \command{distance_squared} function compared with block
        size.
    \item Generally, the smaller the block size was, the faster the algorithm
        executed.
    \item The larger the block size, the more that vectors are pruned
        (conversely, without blocking, not many vectors are pruned).
\end{itemize}

% Lines of best fit
\begin{longtable}{|+>{\bfseries}c|^l|^c|}
    \tableHeader{Block size & Fit & Coefficient of determination ($R^2$)}
    0 &         $2.95232268646359 \times 10^-6 \times x^{1.5701731748}$ &   0.8252617823 \\
    1 &         $1.99974741419878 \times 10^-6 \times x^{1.6279693701}$ &   0.8472712848 \\
    10 &        $2.47146286428157 \times 10^-6 \times x^{1.5942823477}$ &   0.8514101635 \\
    15 &        $2.61779443859478 \times 10^-6 \times x^{1.5882193828}$ &   0.8273032456 \\
    30 &        $2.85347906672221 \times 10^-6 \times x^{1.5810782275}$ &   0.8407365739 \\
    40 &        $2.393            \times 10^-6 \times x^{1.6026893824}$ &   0.8369025885 \\
    45 &        $2.11550069078546 \times 10^-6 \times x^{1.6215256016}$ &   0.8176455619 \\
    60 &        $1.90246021613607 \times 10^-6 \times x^{1.6408351928}$ &   0.807660717 \\
    90 &        $1.8552473060756  \times 10^-6 \times x^{1.6472982903}$ &   0.7956635499 \\
    100 &       $2.45648959267628 \times 10^-6 \times x^{1.5966255392}$ &   0.8105129767 \\
    1000 &      $4.80646490593615 \times 10^-6 \times x^{1.5689092708}$ &   0.8328463309 \\\
    10000 &     $1.07142672605121 \times 10^-6 \times x^{1.8339855181}$ &   0.9182785472 \\
    100000 &    $8.59282468122866 \times 10^-8 \times x^{2.172997051}$  &   0.933976207 \\
    1000000 &   $8.04573229523765 \times 10^-8 \times x^{2.1829343104}$ &   0.9298342132 \\
\end{longtable}